# 建置小韻表檢視

## 利用現成檢視再建新檢視

建置檢視時，也可利用`現成已有之檢視`，再結合`資料表`建立。

```sql
-- 刪除已存在的檢視，如果存在的話
DROP VIEW IF EXISTS 新檢視名稱;

-- 建立新的檢視，結合現有的檢視與某資料表
CREATE VIEW 新檢視名稱 AS
    SELECT 切語上字檢視.*,
           某資料表.欄位1,
           某資料表.欄位2,
           ...
    FROM 切語上字檢視
    JOIN 某資料表 ON 切語上字檢視.某關聯欄位 = 某資料表.某關聯欄位;

```

## 建置切語上字檢視

### 切語上字資料表

`切語上字`資料表的資料表結構(Table Schema)

```sql
CREATE TABLE 切語上字表 (
    識別號          INTEGER PRIMARY KEY,
    廣韻聲母識別號  INTEGER REFERENCES 廣韻聲母對照表 (識別號),
    七聲類          TEXT,
    發音部位        TEXT,
    聲母            TEXT,
    清濁            TEXT,
    發送收          TEXT,
    聲母拼音碼      TEXT,
    切語上字集      TEXT,
    備註            TEXT
);
```

### 現成之`廣韻聲母檢視`

已建置之檢視：廣韻聲母檢視

```sql
CREATE VIEW 廣韻聲母檢視 AS
    SELECT 廣韻聲母對照表.識別號,
           廣韻聲母對照表.廣韻聲母,
           聲母對照表.聲母碼,
           聲母對照表.聲母國際音標,
           聲母對照表.白話字聲母,
           聲母對照表.閩拼聲母,
           聲母對照表.台羅聲母,
           聲母對照表.方音聲母,
           聲母對照表.十五音聲母
      FROM 廣韻聲母對照表
           JOIN
           聲母對照表 ON 廣韻聲母對照表.聲母識別號 = 聲母對照表.識別號;
```

### 套用現成檢視建置新檢視

使用之`切語上字表`資料表，其中關於`聲母`的發音資料，本可用`廣韻聲母識別號`的欄位，
與資料表：`廣韻聲母對照表`的欄位`識別號`串接。

但我已建置了名稱為：`廣韻聲母檢視`之檢視。以便可在此檢視中查閱廣韻聲母，在不同
之福建漢語的拼音系統：白話字、閩拼、台羅、方音符號與十五音的更替規則。

```sql
-- 建立新的檢視，將廣韻聲母檢視的資料引入切語上字表中
CREATE VIEW 切語上字檢視 AS
    SELECT 切語上字表.*,
           廣韻聲母檢視.廣韻聲母,
           廣韻聲母檢視.聲母碼,
           廣韻聲母檢視.聲母國際音標,
           廣韻聲母檢視.白話字聲母,
           廣韻聲母檢視.閩拼聲母,
           廣韻聲母檢視.台羅聲母,
           廣韻聲母檢視.方音聲母,
           廣韻聲母檢視.十五音聲母
      FROM 切語上字表
           LEFT JOIN 廣韻聲母檢視 ON 切語上字表.廣韻聲母識別號 = 廣韻聲母檢視.識別號;
```

套用以上 SQL Script 語法，建置 `切語下字檢視`

```sql
DROP VIEW IF EXISTS 切語下字檢視;

-- 建立新的檢視，將廣韻韻母檢視的資料引入切語上字表中
CREATE VIEW 切語下字檢視 AS
    SELECT 切語下字表.*,
           廣韻韻母檢視.廣韻韻母,
           廣韻韻母檢視.韻母碼,
           廣韻韻母檢視.韻母國際音標,
           廣韻韻母檢視.白話字韻母,
           廣韻韻母檢視.閩拼韻母,
           廣韻韻母檢視.台羅韻母,
           廣韻韻母檢視.方音韻母,
           廣韻韻母檢視.十五音韻母
      FROM 切語下字表
           LEFT JOIN 廣韻韻母檢視 ON 切語下字表.廣韻韻母識別號 = 廣韻韻母檢視.識別號;
```

## 建置小韻表檢視

建置 `小韻檢視` ，資料內容以 `小韻表` 為主，關於聲母(切語上字的拼音字母)與韻母(切語下字的拼音字母)
的拼音相關資料，則取自`切語上字檢視`與`切語下字檢視` 。

### 小韻表的資料結構

```sql
CREATE TABLE 小韻表 (
    識別號     PRIMARY KEY,
    上字表識別號  REFERENCES 切語上字表 (識別號) ON DELETE CASCADE ON UPDATE CASCADE,
    下字表識別號  REFERENCES 切語下字表 (識別號) ON DELETE CASCADE ON UPDATE CASCADE,
    切語,
    拼音,
    小韻字,
    目次編碼,
    小韻字序號,
    小韻字集,
    字數,
    聲母,
    聲母拼音碼,
    發音部位,
    清濁,
    發送收,
    韻母,
    韻母拼音碼,
    調,
    調號,
    備註,
    原有備註,
    異體字,
    其它備註,
);
```

### 檢視建置指令

```sql
DROP VIEW IF EXISTS 小韻檢視;

CREATE VIEW 小韻檢視 AS SELECT
           小韻表.識別號 AS 小韻識別號,
           小韻表.上字表識別號,
           小韻表.下字表識別號,

           小韻表.小韻字,
           小韻表.切語 AS 小韻切語,
           小韻表.拼音 AS 小韻標音,
           小韻表.目次編碼 AS 小韻目次,
           小韻表.小韻字序號,
           --小韻表.小韻字集,
           --小韻表.字數,
           切語上字檢視.廣韻聲母,
           切語上字檢視.七聲類,
           切語上字檢視.發音部位,
           切語上字檢視.清濁,
           切語上字檢視.發送收,
           切語上字檢視.聲母碼,
           切語上字檢視.聲母國際音標,
           切語上字檢視.白話字聲母,
           切語上字檢視.閩拼聲母,
           切語上字檢視.台羅聲母,
           切語上字檢視.方音聲母,
           切語上字檢視.十五音聲母,

           切語下字檢視.廣韻韻母,
           切語下字檢視.目次,
           切語下字檢視.攝,
           切語下字檢視.韻系,
           切語下字檢視.韻目,
           切語下字檢視.調,
           切語下字檢視.呼,
           切語下字檢視.等,
           切語下字檢視.等呼,
           切語下字檢視.韻母碼,
           切語下字檢視.韻母國際音標,
           切語下字檢視.白話字韻母,
           切語下字檢視.閩拼韻母,
           切語下字檢視.台羅韻母,
           切語下字檢視.方音韻母,
           切語下字檢視.十五音韻母

      FROM 小韻表
           LEFT JOIN 切語上字檢視 ON 小韻表.上字表識別號 = 切語上字檢視.識別號
           LEFT JOIN 切語下字檢視 ON 小韻表.下字表識別號 = 切語下字檢視.識別號;
```

### 舊檢視備份

```sql
CREATE VIEW 小韻檢視 AS SELECT
    小韻表.識別號,
    小韻表.小韻字,
    小韻表.切語 AS 小韻切語,
    小韻表.拼音 AS 小韻標音,
    小韻表.目次編碼 AS 目次,
    小韻表.小韻字序號,
    小韻表.小韻字集,
    小韻表.字數,
    切語上字表.發音部位 AS 聲母發音部位,
    切語上字表.清濁,
    切語上字表.發送收,
    廣韻聲母對照表.廣韻聲母,
    廣韻聲母對照表.雅俗通聲母,
    聲母對照表.聲母碼 AS 上字標音,
    聲母對照表.聲母國際音標,
    聲母對照表.白話字聲母,
    聲母對照表.閩拼聲母,
    聲母對照表.台羅聲母,
    聲母對照表.方音聲母,
    切語下字表.攝,
    切語下字表.韻目,
    切語下字表.調,
    切語下字表.呼,
    切語下字表.等,
    切語下字表.韻母,
    切語下字表.等呼,
    廣韻韻母對照表.廣韻韻母,
    廣韻韻母對照表.雅俗通韻母,
    韻母對照表.韻母碼 AS 下字標音,
    韻母對照表.韻母國際音標,
    韻母對照表.白話字韻母,
    韻母對照表.閩拼韻母,
    韻母對照表.台羅韻母,
    韻母對照表.方音韻母
FROM
    小韻表
JOIN
    切語上字表 ON 小韻表.上字表識別號 = 切語上字表.識別號
JOIN
    廣韻聲母對照表 ON 切語上字表.廣韻聲母識別號 = 廣韻聲母對照表.識別號
JOIN
    聲母對照表 ON 廣韻聲母對照表.聲母識別號 = 聲母對照表.識別號
JOIN
    切語下字表 ON 小韻表.下字表識別號 = 切語下字表.識別號
JOIN
    廣韻韻母對照表 ON 切語下字表.廣韻韻母識別號 = 廣韻韻母對照表.識別號
JOIN
    韻母對照表 ON 廣韻韻母對照表.韻母識別號 = 韻母對照表.識別號
```

## 漢字檢視

```sql
CREATE TABLE "字表" (
	"識別號"	INTEGER UNIQUE,
	"字"	,
	"同音字序"	,
	"切語"	,
	"谷歌小韻號"	,
	"小韻識別號"	INTEGER COLLATE NOCASE,
	"拼音"	,
	"字義"	,
	"備註"	,
	FOREIGN KEY("小韻識別號") REFERENCES "小韻表"("識別號") ON DELETE CASCADE,
	PRIMARY KEY("識別號" AUTOINCREMENT)
);
```

```sql
DROP VIEW IF EXISTS 漢字檢視;

CREATE VIEW 漢字檢視 AS SELECT
           字表.識別號 AS 漢字識別號,
           字表.字,
           字表.同音字序,
           字表.切語,
           字表.拼音 AS 漢字標音,
           字表.字義,
           小韻檢視.*
      FROM 字表
           LEFT JOIN 小韻檢視 ON 字表.小韻識別號 = 小韻檢視.小韻識別號;

```

參考：

```sql
CREATE VIEW 漢字廣韻標音檢視 AS SELECT
    字表.識別號 AS 漢字識別號,
    字表.字,
    字表.同音字序,
    字表.切語,
    字表.拼音 AS 漢字標音,
    字表.字義,
    小韻表.小韻字,
    小韻表.目次編碼,
    小韻表.小韻字序號,
    廣韻聲母對照表.廣韻聲母,
    切語上字表.發音部位,
    切語上字表.清濁,
    切語上字表.發送收,
    聲母對照表.聲母碼 AS 上字標音,
    聲母對照表.聲母國際音標,
    聲母對照表.白話字聲母,
    聲母對照表.閩拼聲母,
    聲母對照表.台羅聲母,
    聲母對照表.方音聲母,
    聲母對照表.十五音聲母,
    廣韻韻母對照表.廣韻韻母,
    切語下字表.目次,
    切語下字表.攝,
    切語下字表.韻系,
    切語下字表.韻目,
    切語下字表.調,
    切語下字表.呼,
    切語下字表.等,
    切語下字表.等呼,
    韻母對照表.韻母碼 AS 下字標音,
    韻母對照表.韻母國際音標,
    韻母對照表.白話字韻母,
    韻母對照表.閩拼韻母,
    韻母對照表.台羅韻母,
    韻母對照表.方音韻母,
    韻母對照表.十五音韻母
FROM
    字表
JOIN
    小韻表 ON 字表.小韻識別號 = 小韻表.識別號
JOIN
    切語上字表 ON 小韻表.上字表識別號 = 切語上字表.識別號
JOIN
    廣韻聲母對照表 ON 切語上字表.廣韻聲母識別號 = 廣韻聲母對照表.識別號
JOIN
    聲母對照表 ON 廣韻聲母對照表.聲母識別號 = 聲母對照表.識別號
JOIN
    切語下字表 ON 小韻表.下字表識別號 = 切語下字表.識別號
JOIN
    廣韻韻母對照表 ON 切語下字表.廣韻韻母識別號 = 廣韻韻母對照表.識別號
JOIN
    韻母對照表 ON 廣韻韻母對照表.韻母識別號 = 韻母對照表.識別號
```
