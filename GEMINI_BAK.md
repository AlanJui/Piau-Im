# Gemini Project Context: 閩南語漢字注音自動化系統

## 1. 專案目標 (Project Goals)
本專案旨在建立一套自動化工具，用於處理「漢字」與「台語音標」的對應、查找與 Excel 填入自動化。主要功能包含：
- 自動化將漢字與對應音標填入 Excel 儲存格。
- 支援「人工標音」與「資料庫查找」雙軌模式。
- 提供導讀模式與系統維護工具。

## 2. 核心術語定義 (Vocabulary & Terms)
為了確保程式碼邏輯一致，定義以下術語：
- **【漢字庫】(Han-Ji-Khoo)**: 存放漢字與台羅音標對應關係的 SQLite 資料表。
- **【台語音標】(TLPA: Tai-Gi-Im-Piau)**: 本專案採用【台語音標】作為【羅馬拼音字母】的標準，英文簡寫：TLPA；是為【台羅音標】/【台羅拼音】的前身。TLPA【台語音標】的特色為：讀音=聲母+韻母+調值（聲調），如：【台】字的讀音=t + ai + 5，此種讀音之標示法，便於程式撰寫，易於切分或組合：聲母、韻母、聲調。而【台羅音標】：Tâi = T + âi = 聲母+標調韻母=聲母+（韻母+聲調符號），欲得【聲調】，得自標調韻母【âi】抽離，取得5。
- **【台羅音標】(TL: Tai-Lo)**: 指中華民國教育部發佈的台語羅馬字母拚音標準，又稱：【台羅拼音】。因【台羅音標】為台灣區，閩南話的強勢拼音系統，多數網路線上的【漢字讀音字典】，都採用【台羅音標】為主，為方便操作，故而允許填寫【台語音標】時，可直接複製並貼上取自線上字典的【台羅音標】。
- **【漢字標音】(Han-Ji-Piau-Im)**: 漢字之閩南讀音標準太多，有：切音（十五音）、注音（方音符號）、拼音（白話字、閩拼方案、台語音標、台羅音標、注音二式）等各式各樣。本專案雖採用【台語音標】作為【漢字標音】之標準，但為求供給不同受眾使用自己之慣用之標音系統，故而提供自動轉換之功能，令使用者可在 Excel 的【env】工作表指定欲使用之【漢字標音系統】，由程式依據漢字的【台語音標】自動轉換，生成【漢字標音】，存放於此儲存格。
- **【人工標音】(Manual Annotation)**: 漢字之【台語音標】由程式之查找作業，自動填入。但因漢字具【一字多音】、【文白異讀】，故程式的自動查找，多有誤用問題，故而允許使用者，要求本系統遇【漢字】有手動輸入之【台語音標】或【台羅音標】時，則採用【人工標音】作為漢字指定之【台語音標】。遇有【人工標音】儲存格已有內容時，因其優先權高於資料庫查找，故而系統可直接引用，無需再用字典查找。
- **【env工作表】**: 為適用於不同場合、用途，使用者需有【自行調整】的彈性，本系統為避免程式寫死，特利用 Excel 名為【env】之工作表，依使用需求自行設定，調整程式作業時的參數。
- **【導讀模式】**: 透過交叉游標指引，隱藏人工標音文字（轉為象牙白）以利誦讀。

## 3. 技術環境 (Technical Stack)
- **語言**: Python 3.10+
- **資料庫**: SQLite (檔案名稱固定為 `Ho_Lok_Ue.db`)
- **Excel 互動**: xlwings 函式庫
- **資料表結構**:
    - 資料表 `漢字庫`: 包含 `漢字`, `台羅音標`, `常用度`, `摘要說明`, `更新時間`。

## 4. 關鍵檔案與功能邏輯
- **PRG-a000**: Excel 單一儲存格處理邏輯（包含文章終止 φ、換行 \n 之判定）。
- **PRG-a100**: 自動化填入漢字及其語音標註至 Excel。
- **PRG-a109**: 導讀功能，控制方向鍵移動與字體顏色切換（隱藏/恢復紅色標音）。
- **PRG-a210**: 核心查找邏輯：若有【人工標音】則直接轉換，否則自【漢字庫】查找。
- **PRG-a400**: 自 Excel 活頁簿檔案，讀取：【漢字注音】工作表，每個【漢字標音行】的【漢字】、【台語音標】及【漢字標音】儲存格內容，製作引用 <ruby> tag 的 HTML 網頁檔案。

## 5. 系統維護規範 (Maintenance Rules)
- **音標更正**: 若發現標音錯誤，應透過 SQL Script 統一更新 `漢字庫` 表。
- **特殊校正**: c 開頭需更正為 tsh，z 開頭需更正為 ts。
- **資料庫路徑**: 需透過 `.env` 環境變數讀取資料庫檔案名稱。

## 6. 指令規範
- 在進行程式修改時，優先確保與現有 Excel 命名範圍（如：每列總字數、標音方法）相容。
- 註解應包含關鍵術語，方便後續維護。