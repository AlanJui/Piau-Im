# a109_漢字注音工作表導讀

## 需求摘要

用途：提供 <-- 及 --> （向前/向後）按鍵，以利操作者在誦讀【漢字注音】工作表時，
可利用【作用儲存格】十字交叉的聚焦游標，導引觀眾目光的移動，使逐字的漢字發音誦讀，
更顯有趣。另外，操作者無需借助滑鼠指標，僅需使用【←】或【→】按鍵，便能在上/下行
移動。譬如：在【第2行】的行尾（即儲存格：R9）時，按【→】鍵，游標會跳到【第3行】
的行首（即儲存格：D13）。

## 規格說明

1. 行號與【漢字儲存格】的對映關係如下：

    - 【第1行】的儲存格：D5, E5, F5,... ,R5；
    - 【第2行】的儲存格：D9, E9, F9,... ,R9；
    - 【第3行】的儲存格：D13, E13, F13,... ,R13；

2. 程式開始執行時，【作用儲存格】落於【漢字注音】工作表的第1行行首儲存格（即：D5）。

3. 操作鍵只提供【←】及【→】兩個方向鍵，分別用以控制游標向前或向後移動。

4. 當【作用儲存格】游標位於某行的行首儲存格（如：D9、D13...）時，按【←】鍵，游標會跳到前一行（如：D5、D9...）

    - 連續按【向左】/【向右】鍵快速移動，不會被換行符號打斷
    - 停留在換行符號位置超過 0.5 秒後，會自動跳到下一行
    - 當作用儲存格停在【行尾】（R9），且【下一行】（D13）的【行首】為【換行】時...，按【向右】方向鍵：
          R9 → 按【→】鍵 → 移動到 D13 → 等待 0.5 秒 → 自動跳到 D17
    - 接續上述情境，作用儲存格落在 D17 位置，按【向左】方向鍵兩次，因而回到 R9 儲存格：
      R9 → 按【→】鍵 → 移動到 D13 → 立即按【←】鍵 → 回到 R9
                                      ↑
                            重置計時器，取消自動跳過


5. 當【作用儲存格】游標位於某行的行尾儲存格（如：R5、R9...）時，按【→】鍵，
  游標會跳到下一行（如：D9、D13...）

6. 按【Esc】鍵，可結束本程式的執行。

7. 按【Ctrl+C】鍵，可中斷本程式的執行。

8. 按【空白】/【Q】鍵，可查詢【萌台語字典】。（a220_作用儲存格查找萌典漢字讀音.py）

9. 按【S】鍵，可查詢【個人字典】。 （a222_依作用儲存格在個人字典查找漢字讀音.py）

10. 使用【向上】/【向下】鍵在不同行之間移動

    - 【向上】鍵：移動到上一行的相同欄位：
      D13 → 按【↓】鍵 → 移動到 D17（下一行相同欄位）
    - 【向下】鍵：移動到下一行的相同欄位：
      D17 → 按【↑】鍵 → 移動到 D13（上一行相同欄位）

## 導讀模式

1. 新增兩個樣式管理函數（第 336-393 行）

### hide_manual_annotation_style(wb)

- 將【人工標音儲存格】樣式的字型顏色改為象牙白（與填滿顏色相同）
- 使用 Excel COM API 修改樣式：style.Font.Color = 0xF0FFFF
- BGR 格式：240, 255, 255（象牙白）

### restore_manual_annotation_style(wb)

- 將【人工標音儲存格】樣式的字型顏色改回紅色
- 使用 Excel COM API 修改樣式：style.Font.Color = 0x0000FF
- BGR 格式：0, 0, 255（紅色）

2. 整合到主程式流程

進入導讀模式前（第 912 行）：

```python
# 隱藏人工標音文字
hide_manual_annotation_style(wb)
```

程式結束前（第 939 行）：

```python
# 恢復人工標音文字顏色
restore_manual_annotation_style(wb)
```

異常處理（第 949-951 行）：

- 發生錯誤時也會嘗試恢復樣式，確保不會遺漏

3. 執行流程

程式啟動
  ↓
顯示操作說明
  ↓
【隱藏人工標音】字型顏色改為象牙白
  ↓
切換到 Excel 視窗
  ↓
進入導讀模式（視覺乾淨清爽）
  ↓
使用者按 ESC 鍵
  ↓
【恢復人工標音】字型顏色改回紅色
  ↓
程式結束

### 人工標音儲存格處理細節

✅ 進入導讀模式後，紅色的人工標音文字會「隱藏」（變成象牙白）
✅ 視覺更清爽，不會眼花撩亂
✅ 按 ESC 結束後，自動恢復紅色，方便後續校正作業

## 變更需求

### 應用場景

1. a109 程式原預設功能為：【漢字標音】導讀，適用於製作【閩南語誦讀】之示範影片，可用於導引影片觀賞者的目光焦點。但在應用過程中，發覺 a109 程式亦適合當成漢字標音的【校稿】工具，對於 a200 程式自動標注的漢字讀音，遇有疑問時，
可用【萌典】或【個人字典】查找可能的讀音，並以查到的結果，當成【人工標音】來取代 a200 自動填入的【台語音標】。

亦因此，原本 a109 程式一啟動，便會將【人工標音儲存格】樣式的字型顏色，改成與填滿顏色同的作法，將致【作用儲存格】是否有【人工標音】填入，産生無法辨識的問題。所以， a109 程式需使用【參數】（如：-edit）來控制，要求 a109 當作【校稿工具】使用，所以原本要求【人工標音儲存格】樣式，需變更字型顏色的動作略去。

2. 目前查詢漢字標音所使用的【萌典】或【個人字典】，皆有漢字標音收錄不多之問題。故而我仍需透過不提供 API 的字典網站（如：ChhoeTaigi ==> URL: https://chhoe.taigi.info/），以人工方式查找漢字標音。然後，再手動填到【人工標音】儲存
格。所以，a109 程式進入【導讀模式】時，需提供一個功能鍵（如：按【E】鍵），能插斷 a109 程式，進入【手動輸入台語音標/台羅拼音】功能，供我進行：打字輸入；或是用copy/paste自查找網站抄入。

### 需求規格

1. 啟動 a109 程式時，可用【參數】： -edit ，要求 a109 程式以【校稿】模式運作。
    - 遇【校稿】模式，a109 程式啟動時的初始化設定，不必進行【人工標音儲存格】樣式的設定變更

2. 【導讀模式】新增按鍵【E】，供使用者自行輸入【台語音標】或【台羅拚音】（帶調符的標準格式、帶調號的輸入格式）
    - 在【導讀模式】按【E】鍵，插斷 a109 程式，轉而進入【手動輸入人工標音】模式；
    - 在【手動輸入人工標音】模式中，使用者可手動打字輸入；亦可使用 paste貼入，然後再<Enter>鍵，表示決定將【輸入】填入【人工標音】儲存格；
    - 在【手動輸入人工標音】模式中，若使用者未打字輸入，只是按<Enter>鍵，表放棄輸入。


【附註】：

【台羅拚音】的羅馬拚音字母有兩種格式：

- 標準格式：在羅馬字母上方標示【調符】，表示發音之【聲調】，如：同（Tông）、上（Sióng）；
- 輸入格式：所有的羅馬字母不用【調符】，音節最後的一個字元為數值的【調號】，如：同（Tong5）、上（Siong2）。