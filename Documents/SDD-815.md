# 漢字庫資料表

## 【漢字庫】資料表結構

```sql
CREATE TABLE 漢字庫 (
    識別號  INTEGER PRIMARY KEY AUTOINCREMENT,
    漢字   TEXT    NOT NULL,
    台羅音標 TEXT    NOT NULL,
    常用度  REAL    DEFAULT 0.1,
    摘要說明 TEXT    DEFAULT 'NA',
    更新時間 TEXT    DEFAULT (DATETIME('now', 'localtime')) NOT NULL,
    UNIQUE(漢字, 台羅音標)  -- 加入此行
);
```

確保【漢字庫】資料表，不會發生【漢字】欄、【台羅音標】欄資料重複之問題。

```sql
CREATE UNIQUE INDEX idx_漢字_台羅音標 ON 漢字庫 (漢字, 台羅音標);
```

有了這個 UNIQUE INDEX 後：

1. 防止重複資料：當嘗試插入相同的【漢字】+【台羅音標】組合時，會觸發 CONFLICT
2. ON CONFLICT 生效：您程式中的 ON CONFLICT(漢字, 台羅音標) DO UPDATE 語法現在可以正常運作
3. 自動更新：如果資料已存在，只會更新【更新時間】欄位，不會產生重複記錄

```sql
cursor.execute("""
    INSERT INTO 漢字庫 (漢字, 台羅音標, 常用度, 摘要說明, 更新時間)
    VALUES (?, ?, ?, ?, ?)
    ON CONFLICT(漢字, 台羅音標) DO UPDATE
    SET 更新時間=CURRENT_TIMESTAMP;
""", (han_ji, tl_im_piau, siong_iong_too, "NA", datetime.now().strftime("%Y-%m-%d %H:%M:%S")))
```

```sql
-- 為現有資料表加入 UNIQUE INDEX
CREATE UNIQUE INDEX IF NOT EXISTS idx_漢字_台羅音標 ON 漢字庫 (漢字, 台羅音標);

```

