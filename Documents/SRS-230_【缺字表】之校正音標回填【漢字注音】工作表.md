# 缺字表之校正音標回填漢字注音工作表

## 功能摘要

自動查找漢字之【台語音標】功能，遇有【漢字庫】資料庫未登錄某漢字之標音時，
會在【缺字表】工作表留下紀錄，記敘尚未漢字標音之【漢字】及其【座標】（指
向【漢字注音】工作表之【漢字】儲存格）。

執行 a200 作業之後，若漢字發生找不到台語音標之狀況，使用者可以人工作業
方式，手動上網查找漢字之【台語音標】，然後填入【缺字表】之【台語音標】欄
。由於當前，【台羅拼音】為台語拼音系統之主流，故網上找到之漢字，其讀音多
用【台羅音標】標注，且音標之【聲調】慣以【聲調符號】（調符）標示；對於
台羅聲調之【陰平】調（調號1）及【陰入】調（調號4），則略去調符不用。

本系統雖以【台語音標+】（簡稱：台語音標）標注漢字之讀音，但為便利使用者，並配合目前之主流趨勢，
允許使用者在【缺字表】之【台語音標】欄，以【台羅音標】填入。但系統在執行
a230 作業時，會將「帶調符且簡寫」之【台語音標】轉成【台語音標】，並填入
【校正音標】欄，如：

【襜】：【台羅音標】Tshiam	==> ciam1【台語音標】

## 細節描述

【缺字表】工作表範例：

| 漢字 | 總數 | 台語音標   | 校正音標  | 座標        |
|----|----|--------|-------|-----------|
| 檻  | 0  | Lām    | lam7  | (285, 4)  |
| 軫  | 0  | Tsín   | zin2  | (5, 17)   |
| 閻  | 0  | Iâm    | iam5  | (29, 4)   |
| 襜  | 0  | Tshiam | ciam1 | (33, 8)   |
| 潦  | 0  | Ló     | lo2   | (57, 14)  |
| 驂  | 0  | Tsham  | cam1  | (61, 16)  |
| 騑  | 0  | Hui    | hui1  | (61, 17)  |
| 鳧  | 0  | Hû     | hu5   | (77, 5)   |
| 闥  | 0  | That   | that4 | (81, 14)  |
| 盱  | 0  | u      | u1    | (85, 14)  |
| 矚  | 0  | Tsiok  | ziok4 | (85, 17)  |
| 舸  | 0  | Khó    | kho2  | (89, 16)  |
| 霽  | 0  | Tsè    | ze3   | (93, 16)  |
| 鶩  | 0  | Bo̍k   | bok8  | (97, 12)  |
| 蠡  | 0  | Lê     | le5   | (101, 17) |
| 遄  | 0  | Tshuân | cuan5 | (113, 11) |
| 籟  | 0  | Nāi    | nai7  | (113, 15) |
| 迥  | 0  | Híng   | hing2 | (133, 4)  |
| 溟  | 0  | Bîng   | bing5 | (141, 14) |
| 閽  | 0  | Hun    | hun1  | (153, 6)  |
| 舛  | 0  | Tshuàn | cuan3 | (157, 14) |
| 懽  | 0  | Huan   | huan1 | (181, 8)  |
| 賒  | 0  | sia    | sia1  | (181, 13) |

以上【缺字表】之 E 欄（欄名稱：座標），存放【漢字注音】工作表之儲存格座標位置；
需注意：此處存放的值是【座標 list】，也就是，座標數可能有 1 個以上，
如：(5, 17); (33, 8); (77, 5)，用以表示某【漢字】在【漢字注音】工作表，
共有 3 處（3個座標），皆是沒有標注【台語音標】。

需請撰碼，自【缺字表】工作表之【座標】欄找出【漢字注音】工作表，【漢字】無標注
【台語音標】處有幾個；然後以迴圈進行作業，將【校正音標】欄之值填入【漢字注音】工作表
之【台語音標】儲存格。

【缺字表】工作表

- 【漢字】欄：A欄
- 【台語音標】欄：D欄
- 【座標】欄：E欄

【註】：座標欄之座標值，指向【漢字注音】工作表之【漢字】儲存格座標

【漢字注音】工作表

- 【台語音標】儲存格座標：【漢字】儲存格座標 row - 1


## 設計重點

### 座標清單解析

座標清單（Coordinate Tuples List），如何將【字串】轉換成【座標清單】，並解析
清單中每一個座標之 (row, col) 列、欄座標位址。

1. 分析【字串】： "(5, 17); (33, 8); (77, 5)" ；
2. 解析出所有的【座標 tuple】： [(5, 17), (33, 8), (77, 5)]；
3. 取出一組【座標】，分解出【列座標】值：5；【欄座標】值：17。

```python
# 利用正規表達式解析所有形如 (row, col) 的座標
coordinate_tuples = re.findall(r"\((\d+)\s*,\s*(\d+)\)", coordinates_str)
for tup in coordinate_tuples:
    try:
        r_coord = int(tup[0])
        c_coord = int(tup[1])
    except ValueError:
        continue  # 若轉換失敗，跳過該組座標
```

### 正規式解析


這段程式碼使用 Python 的 re 模組和正規表達式來從字串中找出所有形如 (row, col) 的座標，並將它們轉換成整數型態的 tuple。以下逐步說明其運作原理：

1. 解析座標字串：

```python
coordinate_tuples = re.findall(r"\((\d+)\s*,\s*(\d+)\)", coordinates_str)
```

- \( 與 \)：分別匹配字串中的左括號和右括號。

- (\d+)：捕捉一個或多個數字，這裡第一個 (\d+) 用來匹配 row 值，第二個則匹配 col 值。

- \s*：表示零個或多個空白字元。放在逗號前後可確保格式彈性（例如，逗號兩側可以有空格）。

- re.findall 回傳一個包含所有匹配結果的列表，每個匹配結果都是一個 tuple，包含兩個字串（分別代表 row 與 col）。

2. 轉換成數字型態：

```python
for tup in coordinate_tuples:
    try:
        r_coord = int(tup[0])
        c_coord = int(tup[1])
    except ValueError:
        continue  # 若轉換失敗，跳過該組座標
```

- 利用 int() 函式將捕捉到的字串轉換成整數。

- 如果遇到無法轉換的情況（例如捕捉到非數字內容），會觸發 ValueError，並透過 continue 跳過該組座標。
