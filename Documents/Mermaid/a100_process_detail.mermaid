flowchart TD
    A2[[開始 單格]] --> B2[讀取儲存格 與 清除樣式]
    B2 --> C2{內容為 終結符號 φ}
    C2 -->|是| D2[設 EOF 並 設訊息 文字終結]
    C2 -->|否| E2{內容為 換行符號}
    E2 -->|是| F2[設訊息 換行]
    E2 -->|否| G2{內容為 漢字}

    %% 非漢字分支
    G2 -->|否| H2[轉字串 去空白]
    H2 --> I2{為標點符號}
    I2 -->|是| J2[設訊息 標點符號]
    I2 -->|否| K2{為整數的浮點數}
    K2 -->|是| L2[轉成整數字串 並 設訊息 英數半形]
    K2 -->|否| M2{字串為空}
    M2 -->|否| X2[不變更訊息]
    M2 -->|是| N2{連續空白次數}
    N2 -->|第一次| O2[次數加一 並 設訊息 空白]
    N2 -->|第二次| P2[設 EOF 並 設訊息 空白]

    %% 漢字分支
    G2 -->|是| Q2{漢字不為空}
    Q2 -->|否| X2
    Q2 -->|是| R2[查字庫 取得結果]
    R2 --> S2{查到結果}
    S2 -->|否| T2[登錄缺字 並 設訊息 查無此字]
    S2 -->|是| U2[轉換為 台語音標 與 漢字標音]
    U2 --> V2[寫入上下列 並 設訊息 已標音]
    V2 --> W2[更新標音字庫]

    %% 收束
    D2 --> Y2[列印進度]
    F2 --> Y2
    J2 --> Y2
    L2 --> Y2
    O2 --> Y2
    P2 --> Y2
    X2 --> Y2
    T2 --> Y2
    W2 --> Y2
    Y2[[返回 內層迴圈]]
