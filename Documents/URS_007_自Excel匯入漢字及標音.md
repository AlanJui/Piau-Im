# 自 Excel 匯入漢字及標音

## 功能簡介

系統使用 SQLite 資料庫，以【漢字庫】資料表，保存【漢字】及其【標音】。而漢字標音之標準
採用【台羅拼音系統】。

因漢字及其標音之收集，非直接輸入【漢字庫】資料表；而是以 Excel 先集結、彙總。故而系統需要
有一功能，可將 Excel 活頁簿檔案中之【工作表】，直接匯入【漢字庫】資料表。

Excel工作表之【表格結構】：

| 漢字 | 台羅音標 | 常用度 | 摘要說明                                            | 更新時間       |
|------|----------|--------|-----------------------------------------------------|----------------|
| 委   | ui2      | 0.8    | 背 重擔 bōe 伸直; 擔當, 託仗, 彎曲, hiat-ka̍k, 委員. | 2025/2/2 19:53 |
| 屈   | khut4    | 0.8    | 彎曲, 曲, 向下, 請, 降伏, 鬱卒, 屈曲, ut曲; 枉屈.   | 2025/2/2 19:53 |
|      |          |        |                                                     |                |

## 功能需求

- 欲匯入之 Excel 檔案，不要在程式碼中固定，而是使用【作用中活頁簿檔】（意即：已被打開之 Excel 活頁簿檔案，且處於【作用中】狀態；（作法可參考程式碼檔案：a850_使用Excel重建漢字庫.py）
- 預設匯入之工作表，其名稱為：【漢字庫】；次常用之工作表為：【甲骨釋文漢字庫】；但使用者亦可在【終端機】以【參數】型式
用【人工輸入字串】，指定工作表名稱，如：【辭彙】、【台灣俚語】、【閩南俗諺】...
- 【漢字庫】資料表不要刪除及重建；
- 自工作表匯入到【漢字庫】資料表之【資料紀錄】，以【添加】（Append）模式加入；
- 存放在【工作表】之【漢字】、【標音】，有可能與【漢字庫】資料表已有之資料重複。遇有此等【資料重複】狀況發生時，請在【終端機】顯示個【警示訊息】即可，切勿令程式執行中斷。

## 漢字庫資料表規格

### 資料表結構

```sql
-- 建置資料表結構
CREATE TABLE 漢字庫 (
    識別號  INTEGER PRIMARY KEY AUTOINCREMENT,
    漢字    TEXT    NOT NULL,
    台羅音標 TEXT    NOT NULL,
    常用度  REAL    DEFAULT 0.1,
    摘要說明 TEXT    DEFAULT NA,
    更新時間 TEXT    DEFAULT (DATETIME('now', 'localtime') ) NOT NULL
);

-- 建置 UNIQUE INDEX
CREATE UNIQUE INDEX idx_漢字_台羅音標 ON 漢字庫 (漢字, 台羅音標);
```

### 索引設計規格

【漢字】本有【一字多音】之特性；且【河洛話】之漢字尚分有：【文讀音】、【白話音】兩類型。以下用漢字【行】舉例說明此特性：

漢字：【行】

《文讀音》：
- hing5
- hing7
- hang5

《白話音》：
- kiann5
- tsua7

為免資料紀錄重複，故借助資料庫系統【索引】，具【唯一性】特性，因而【漢字庫】資料表之設計，以：【漢字】、【台語音標】兩欄之資料，共構【索引】，用以確保資料紀錄不會發生重複之問題。



## 程式實作

### 程式碼說明

1. 功能核心：

    - 從 Excel 活頁簿中讀取指定工作表的資料。

    - 將資料匯入 SQLite 資料庫的【漢字庫】資料表。

    - 確保【漢字】與【台羅音標】的組合具有唯一性。

2. 參數設定：

    預設工作表名稱為【漢字庫】，但允許使用者透過終端機輸入參數指定其他工作表名稱。

3. 資料驗證：

    - 檢查漢字與台羅音標是否為有效資料。

    - 若資料無效，跳過該筆資料並記錄錯誤。

4. 錯誤處理：

    - 若工作表不存在，顯示錯誤訊息。

    - 若資料重複，跳過並記錄錯誤。

5. 日誌記錄：

    使用 logging 模組記錄程式執行過程。

### 執行範例

1. 終端機指令：

    ```bash
    python a851.py
    ```

    從預設工作表【漢字庫】匯入資料。

2. 指定工作表名稱：

    ```bash
    python a851.py 辭彙
    ```

    從名為【辭彙】的工作表匯入資料。

### 預期輸出

1. 成功執行：

    顯示「✅ 資料已成功從工作表 '{sheet_name}' 匯入【漢字庫】資料表！」。

2. 錯誤情況：

    - 若工作表不存在，顯示「⚠️ 無法找到工作表: {sheet_name}」。

    - 若資料無效，顯示「⚠️ 跳過無效資料: Excel 第 {idx} 列：缺【漢字】或【台羅音標】」。

    - 若發生其他錯誤，顯示「❌ 匯入資料失敗: {錯誤訊息}」。